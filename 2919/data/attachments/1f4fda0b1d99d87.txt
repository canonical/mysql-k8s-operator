[32mINFO    [0m pytest_operator.plugin:plugin.py:790 Model status:

Model    Controller          Cloud/Region        Version  SLA          Timestamp
testing  concierge-microk8s  microk8s/localhost  3.6.5    unsupported  01:44:43Z

App      Version                  Status       Scale  Charm             Channel      Rev  Address         Exposed  Message
app0     0.0.2                    active           1  mysql-test-app    latest/edge   73  10.152.183.204  no       Last written value=234
app1     0.0.2                    active           1  mysql-test-app    latest/edge   73  10.152.183.100  no       Last written value=129
app2     0.0.2                    active           1  mysql-test-app    latest/edge   73  10.152.183.206  no       Last written value=221
app3     0.0.2                    active           1  mysql-test-app    latest/edge   73  10.152.183.211  no       Last written value=210
app4     0.0.2                    active           1  mysql-test-app    latest/edge   73  10.152.183.199  no       Last written value=111
app5     0.0.2                    active           1  mysql-test-app    latest/edge   73  10.152.183.146  no       Last written value=282
app6     0.0.2                    active           1  mysql-test-app    latest/edge   73  10.152.183.34   no       Last written value=278
mysql    8.0.41-0ubuntu0.22.04.1  active           1  mysql-k8s                        0  10.152.183.220  no       
router0  8.0.41-0ubuntu0.22.04.1  maintenance      1  mysql-router-k8s  8.0/edge     727  10.152.183.210  no       Waiting for K8s service connectivity
router1  8.0.41-0ubuntu0.22.04.1  maintenance      1  mysql-router-k8s  8.0/edge     727  10.152.183.56   no       Waiting for K8s service connectivity
router2  8.0.41-0ubuntu0.22.04.1  active           1  mysql-router-k8s  8.0/edge     727  10.152.183.32   no       
router3  8.0.41-0ubuntu0.22.04.1  maintenance      1  mysql-router-k8s  8.0/edge     727  10.152.183.162  no       Waiting for K8s service connectivity
router4  8.0.41-0ubuntu0.22.04.1  active           1  mysql-router-k8s  8.0/edge     727  10.152.183.186  no       
router5  8.0.41-0ubuntu0.22.04.1  maintenance      1  mysql-router-k8s  8.0/edge     727  10.152.183.139  no       Waiting for K8s service connectivity
router6  8.0.41-0ubuntu0.22.04.1  maintenance      1  mysql-router-k8s  8.0/edge     727  10.152.183.114  no       Waiting for K8s service connectivity

Unit        Workload  Agent  Address       Ports  Message
app0/0*     active    idle   10.1.128.138         Last written value=234
app1/0*     active    idle   10.1.128.140         Last written value=129
app2/0*     active    idle   10.1.128.141         Last written value=221
app3/0*     active    idle   10.1.128.143         Last written value=210
app4/0*     active    idle   10.1.128.144         Last written value=111
app5/0*     active    idle   10.1.128.147         Last written value=282
app6/0*     active    idle   10.1.128.149         Last written value=278
mysql/0*    active    idle   10.1.128.137         Primary
router0/0*  active    idle   10.1.128.139         
router1/0*  active    idle   10.1.128.142         
router2/0*  active    idle   10.1.128.145         
router3/0*  active    idle   10.1.128.146         
router4/0*  active    idle   10.1.128.148         
router5/0*  active    idle   10.1.128.150         
router6/0*  active    idle   10.1.128.151         

[32mINFO    [0m pytest_operator.plugin:plugin.py:796 Juju error logs:

controller-0: 01:36:00 ERROR juju.worker.caasapplicationprovisioner.runner exited "app4": refreshing application status for "app4": rpc error: code = Unavailable desc = error reading from server: read unix @->/var/snap/microk8s/8155/var/kubernetes/backend/kine.sock:12379: read: connection reset by peer
controller-0: 01:36:00 ERROR juju.worker.caasapplicationprovisioner.runner exited "router5": refreshing application status for "router5": rpc error: code = Unavailable desc = error reading from server: read unix @->/var/snap/microk8s/8155/var/kubernetes/backend/kine.sock:12379: read: connection reset by peer
controller-0: 01:36:00 ERROR juju.worker.caasapplicationprovisioner.runner exited "app2": refreshing application status for "app2": rpc error: code = Unavailable desc = error reading from server: read unix @->/var/snap/microk8s/8155/var/kubernetes/backend/kine.sock:12379: read: connection reset by peer
unit-router3-1: 01:36:00 ERROR unit.router3/1.juju-log backend-database:37: Uncaught exception while in charm code:
Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-router3-1/charm/venv/lib/python3.10/site-packages/lightkube/core/generic_client.py", line 235, in raise_for_status
    resp.raise_for_status()
  File "/var/lib/juju/agents/unit-router3-1/charm/venv/lib/python3.10/site-packages/httpx/_models.py", line 761, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Server error '500 Internal Server Error' for url 'https://10.152.183.1/apis/apps/v1/namespaces/testing/statefulsets/router3'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/500

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-router3-1/charm/src/charm.py", line 448, in <module>
    ops.main.main(KubernetesRouterCharm)
  File "/var/lib/juju/agents/unit-router3-1/charm/venv/lib/python3.10/site-packages/ops/main.py", line 436, in main
    _emit_charm_event(charm, dispatcher.event_name)
  File "/var/lib/juju/agents/unit-router3-1/charm/venv/lib/python3.10/site-packages/ops/main.py", line 144, in _emit_charm_event
    event_to_emit.emit(*args, **kwargs)
  File "/var/lib/juju/agents/unit-router3-1/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 351, in emit
    framework._emit(event)
  File "/var/lib/juju/agents/unit-router3-1/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 853, in _emit
    self._reemit(event_path)
  File "/var/lib/juju/agents/unit-router3-1/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 942, in _reemit
    custom_handler(event)
  File "/var/lib/juju/agents/unit-router3-1/charm/lib/charms/data_platform_libs/v0/data_interfaces.py", line 3141, in _on_relation_changed_event
    getattr(self.on, "database_created").emit(
  File "/var/lib/juju/agents/unit-router3-1/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 351, in emit
    framework._emit(event)
  File "/var/lib/juju/agents/unit-router3-1/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 853, in _emit
    self._reemit(event_path)
  File "/var/lib/juju/agents/unit-router3-1/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 942, in _reemit
    custom_handler(event)
  File "/var/lib/juju/agents/unit-router3-1/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 735, in wrapped_function
    return callable(*args, **kwargs)  # type: ignore
  File "/var/lib/juju/agents/unit-router3-1/charm/src/abstract_charm.py", line 275, in reconcile
    if not self._upgrade.versions_set:
  File "/var/lib/juju/agents/unit-router3-1/charm/src/charm.py", line 110, in _upgrade
    return kubernetes_upgrade.Upgrade(self)
  File "/var/lib/juju/agents/unit-router3-1/charm/src/kubernetes_upgrade.py", line 74, in __init__
    partition.get(app_name=charm_.app.name)
  File "/var/lib/juju/agents/unit-router3-1/charm/src/kubernetes_upgrade.py", line 55, in get
    lightkube.Client()
  File "/var/lib/juju/agents/unit-router3-1/charm/venv/lib/python3.10/site-packages/lightkube/core/client.py", line 230, in get
    return self._client.request("get", res=res, name=name, namespace=namespace)
  File "/var/lib/juju/agents/unit-router3-1/charm/venv/lib/python3.10/site-packages/lightkube/core/generic_client.py", line 311, in request
    return self.handle_response(method, resp, br)
  File "/var/lib/juju/agents/unit-router3-1/charm/venv/lib/python3.10/site-packages/lightkube/core/generic_client.py", line 251, in handle_response
    self.raise_for_status(resp)
  File "/var/lib/juju/agents/unit-router3-1/charm/venv/lib/python3.10/site-packages/lightkube/core/generic_client.py", line 237, in raise_for_status
    raise transform_exception(e)
lightkube.core.exceptions.ApiError: rpc error: code = Unavailable desc = error reading from server: read unix @->/var/snap/microk8s/8155/var/kubernetes/backend/kine.sock:12379: read: connection reset by peer
unit-router3-1: 01:36:01 ERROR juju.worker.uniter.operation hook "backend-database-relation-changed" (via hook dispatching script: dispatch) failed: exit status 1
unit-router3-2: 01:36:09 ERROR unit.router3/2.juju-log backend-database:37: Uncaught exception while in charm code:
Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-router3-2/charm/venv/lib/python3.10/site-packages/ops/model.py", line 2955, in _run
    result = subprocess.run(args, **kwargs)  # type: ignore
  File "/usr/lib/python3.10/subprocess.py", line 526, in run
    raise CalledProcessError(retcode, process.args,
subprocess.CalledProcessError: Command '('/var/lib/juju/tools/unit-router3-2/secret-get', 'secret://f532c371-c490-417b-8c87-0deb21fcde03/d06oi2mfjdcs7bel6agg', '--label', 'backend-database.37.user.secret', '--format=json')' returned non-zero exit status 1.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-router3-2/charm/src/charm.py", line 448, in <module>
    ops.main.main(KubernetesRouterCharm)
  File "/var/lib/juju/agents/unit-router3-2/charm/venv/lib/python3.10/site-packages/ops/main.py", line 436, in main
    _emit_charm_event(charm, dispatcher.event_name)
  File "/var/lib/juju/agents/unit-router3-2/charm/venv/lib/python3.10/site-packages/ops/main.py", line 144, in _emit_charm_event
    event_to_emit.emit(*args, **kwargs)
  File "/var/lib/juju/agents/unit-router3-2/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 351, in emit
    framework._emit(event)
  File "/var/lib/juju/agents/unit-router3-2/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 853, in _emit
    self._reemit(event_path)
  File "/var/lib/juju/agents/unit-router3-2/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 942, in _reemit
    custom_handler(event)
  File "/var/lib/juju/agents/unit-router3-2/charm/lib/charms/data_platform_libs/v0/data_interfaces.py", line 3131, in _on_relation_changed_event
    self.relation_data._register_secrets_to_relation(event.relation, diff.added)
  File "/var/lib/juju/agents/unit-router3-2/charm/lib/charms/data_platform_libs/v0/data_interfaces.py", line 1759, in _register_secrets_to_relation
    self._register_secret_to_relation(relation.name, relation.id, secret_uri, group)
  File "/var/lib/juju/agents/unit-router3-2/charm/lib/charms/data_platform_libs/v0/data_interfaces.py", line 1744, in _register_secret_to_relation
    CachedSecret(self._model, self.component, label, secret_id).meta
  File "/var/lib/juju/agents/unit-router3-2/charm/lib/charms/data_platform_libs/v0/data_interfaces.py", line 649, in meta
    self._secret_meta = self._model.get_secret(id=self._secret_uri, label=self.label)
  File "/var/lib/juju/agents/unit-router3-2/charm/venv/lib/python3.10/site-packages/ops/model.py", line 276, in get_secret
    content = self._backend.secret_get(id=id, label=label)
  File "/var/lib/juju/agents/unit-router3-2/charm/venv/lib/python3.10/site-packages/ops/model.py", line 3311, in secret_get
    result = self._run('secret-get', *args, return_output=True, use_json=True)
  File "/var/lib/juju/agents/unit-router3-2/charm/venv/lib/python3.10/site-packages/ops/model.py", line 2957, in _run
    raise ModelError(e.stderr) from e
ops.model.ModelError: ERROR rpc error: code = Unavailable desc = error reading from server: read unix @->/var/snap/microk8s/8155/var/kubernetes/backend/kine.sock:12379: read: connection reset by peer

unit-router3-2: 01:36:10 ERROR juju.worker.uniter.operation hook "backend-database-relation-changed" (via hook dispatching script: dispatch) failed: exit status 1
unit-mysql-2: 01:40:28 ERROR unit.mysql/2.juju-log upgrade:1: get_unit_address: unit DNS domain name is not fully propagated yet, trying again
unit-mysql-2: 01:40:30 ERROR unit.mysql/2.juju-log upgrade:1: get_unit_address: unit DNS domain name is not fully propagated yet, trying again
unit-mysql-1: 01:40:31 ERROR unit.mysql/1.juju-log database-peers:0: get_unit_address: unit DNS domain name is not fully propagated yet, trying again
unit-mysql-2: 01:40:32 ERROR unit.mysql/2.juju-log upgrade:1: get_unit_address: unit DNS domain name is not fully propagated yet, trying again
unit-mysql-1: 01:40:33 ERROR unit.mysql/1.juju-log database-peers:0: get_unit_address: unit DNS domain name is not fully propagated yet, trying again
unit-mysql-1: 01:40:35 ERROR unit.mysql/1.juju-log database-peers:0: get_unit_address: unit DNS domain name is not fully propagated yet, trying again

[32mINFO    [0m pytest_operator.plugin:plugin.py:862 Forgetting main...