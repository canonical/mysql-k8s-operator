{"uid":"4b6089c29d881be","name":"test_fail_and_rollback","fullName":"tests.integration.high_availability.test_upgrade#test_fail_and_rollback","historyId":"7b60ca258c1b888a52b0227496ab19d3","time":{"start":1761444049216,"stop":1761444109507,"duration":60291},"description":"Test an upgrade failure and its rollback.","descriptionHtml":"<p>Test an upgrade failure and its rollback.</p>\n","status":"broken","statusMessage":"KeyError: 'defaultreplicaset'","statusTrace":"Traceback (most recent call last):\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: Optional[TResult] = func()\n                                ^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 262, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n            ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 182, in _multicall\n    return outcome.get_result()\n           ^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_result.py\", line 100, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 177, in pytest_runtest_call\n    raise e\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 169, in pytest_runtest_call\n    item.runtest()\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/python.py\", line 1792, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 182, in _multicall\n    return outcome.get_result()\n           ^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_result.py\", line 100, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/python.py\", line 194, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/tests/integration/high_availability/test_upgrade.py\", line 171, in test_fail_and_rollback\n    check_mysql_units_writes_increment(juju, MYSQL_APP_NAME, mysql_remaining_units)\n  File \"/root/spread_project/tests/integration/high_availability/high_availability_helpers_new.py\", line 70, in check_mysql_units_writes_increment\n    app_primary = get_mysql_primary_unit(juju, app_name)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/tests/integration/high_availability/high_availability_helpers_new.py\", line 311, in get_mysql_primary_unit\n    mysql_cluster_topology = mysql_cluster_status[\"defaultreplicaset\"][\"topology\"]\n                             ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^\nKeyError: 'defaultreplicaset'","flaky":false,"newFailed":false,"newBroken":true,"newPassed":false,"retriesCount":1,"retriesStatusChange":true,"beforeStages":[{"name":"juju","time":{"start":1761443608807,"stop":1761443609100,"duration":293},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"charm","time":{"start":1761443767623,"stop":1761443767623,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"tmp_path_factory","time":{"start":1761443767623,"stop":1761443767624,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"ops_test","time":{"start":1761443767624,"stop":1761443767925,"duration":301},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop","time":{"start":1761443767624,"stop":1761443767624,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"abort_on_fail","time":{"start":1761444047173,"stop":1761444047173,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"continuous_writes","time":{"start":1761444047173,"stop":1761444049216,"duration":2043},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"Test an upgrade failure and its rollback.","status":"broken","statusMessage":"KeyError: 'defaultreplicaset'","statusTrace":"Traceback (most recent call last):\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: Optional[TResult] = func()\n                                ^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 262, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n            ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 182, in _multicall\n    return outcome.get_result()\n           ^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_result.py\", line 100, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 177, in pytest_runtest_call\n    raise e\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 169, in pytest_runtest_call\n    item.runtest()\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/python.py\", line 1792, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 182, in _multicall\n    return outcome.get_result()\n           ^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_result.py\", line 100, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/python.py\", line 194, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/tests/integration/high_availability/test_upgrade.py\", line 171, in test_fail_and_rollback\n    check_mysql_units_writes_increment(juju, MYSQL_APP_NAME, mysql_remaining_units)\n  File \"/root/spread_project/tests/integration/high_availability/high_availability_helpers_new.py\", line 70, in check_mysql_units_writes_increment\n    app_primary = get_mysql_primary_unit(juju, app_name)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/tests/integration/high_availability/high_availability_helpers_new.py\", line 311, in get_mysql_primary_unit\n    mysql_cluster_topology = mysql_cluster_status[\"defaultreplicaset\"][\"topology\"]\n                             ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^\nKeyError: 'defaultreplicaset'","steps":[],"attachments":[{"uid":"135dd34818055374","name":"log","source":"135dd34818055374.txt","type":"text/plain","size":5075}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"continuous_writes::finalizer","time":{"start":1761444109511,"stop":1761444110540,"duration":1029},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"abort_on_fail::0","time":{"start":1761444110540,"stop":1761444110540,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"ops_test::finalizer","time":{"start":1761444110541,"stop":1761444110987,"duration":446},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::2","time":{"start":1761444110987,"stop":1761444110988,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"juju::0","time":{"start":1761444110988,"stop":1761444111277,"duration":289},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::_close_event_loop","time":{"start":1761444110988,"stop":1761444110988,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::_provide_clean_event_loop","time":{"start":1761444110988,"stop":1761444110988,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"tag","value":"abort_on_fail"},{"name":"parentSuite","value":"tests.integration.high_availability"},{"name":"suite","value":"test_upgrade"},{"name":"host","value":"runnervmwhb2z"},{"name":"thread","value":"18478-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.integration.high_availability.test_upgrade"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[{"uid":"eea5e5af19541049","status":"unknown","time":{}}],"categories":[{"name":"Test defects","matchedStatuses":[]}],"history":{"statistic":{"failed":0,"broken":26,"skipped":53,"passed":496,"unknown":24,"total":599},"items":[{"uid":"a129a62fd07b8562","reportUrl":"../3372//#testresult/a129a62fd07b8562","status":"passed","time":{"start":1761357323067,"stop":1761357673130,"duration":350063}},{"uid":"3d385d8c35318fc7","reportUrl":"../3364//#testresult/3d385d8c35318fc7","status":"passed","time":{"start":1761271403084,"stop":1761271751771,"duration":348687}},{"uid":"5bead9caa7392e4e","reportUrl":"../3358//#testresult/5bead9caa7392e4e","status":"passed","time":{"start":1761184184471,"stop":1761184566132,"duration":381661}},{"uid":"d2d10322e9597e70","reportUrl":"../3355//#testresult/d2d10322e9597e70","status":"passed","time":{"start":1761104308282,"stop":1761104658528,"duration":350246}},{"uid":"ccbe7aeb824403a1","reportUrl":"../3351//#testresult/ccbe7aeb824403a1","status":"passed","time":{"start":1761012123864,"stop":1761012443380,"duration":319516}},{"uid":"235197e42f7a2f40","reportUrl":"../3344//#testresult/235197e42f7a2f40","status":"broken","statusDetails":"KeyError: 'defaultreplicaset'","time":{"start":1760926287887,"stop":1760926365056,"duration":77169}},{"uid":"af8f6c0e0c78aff1","reportUrl":"../3343//#testresult/af8f6c0e0c78aff1","status":"broken","statusDetails":"KeyError: 'defaultreplicaset'","time":{"start":1760838940445,"stop":1760839020534,"duration":80089}},{"uid":"94352e943a97ab98","reportUrl":"../3342//#testresult/94352e943a97ab98","status":"passed","time":{"start":1760777515136,"stop":1760777874060,"duration":358924}},{"uid":"61ead8c8f20aabcd","reportUrl":"../3338//#testresult/61ead8c8f20aabcd","status":"passed","time":{"start":1760684825830,"stop":1760685136509,"duration":310679}},{"uid":"f65ea213fbe70a77","reportUrl":"../3336//#testresult/f65ea213fbe70a77","status":"passed","time":{"start":1760580452698,"stop":1760580800816,"duration":348118}},{"uid":"fc5b35ea5f57d73d","reportUrl":"../3334//#testresult/fc5b35ea5f57d73d","status":"passed","time":{"start":1760493608407,"stop":1760493949303,"duration":340896}},{"uid":"35d4666749f4fcfb","reportUrl":"../3327//#testresult/35d4666749f4fcfb","status":"passed","time":{"start":1760407780925,"stop":1760408129724,"duration":348799}},{"uid":"46be57dd34cf080a","reportUrl":"../3326//#testresult/46be57dd34cf080a","status":"broken","statusDetails":"KeyError: 'defaultreplicaset'","time":{"start":1760321543751,"stop":1760321610628,"duration":66877}},{"uid":"97900d1a299302a9","reportUrl":"../3325//#testresult/97900d1a299302a9","status":"passed","time":{"start":1760236999533,"stop":1760237363388,"duration":363855}},{"uid":"5982a8cd42e22533","reportUrl":"../3324//#testresult/5982a8cd42e22533","status":"passed","time":{"start":1760147884878,"stop":1760148238945,"duration":354067}},{"uid":"3712f99fce23fd7a","reportUrl":"../3323//#testresult/3712f99fce23fd7a","status":"broken","statusDetails":"KeyError: 'defaultreplicaset'","time":{"start":1760061868462,"stop":1760061924586,"duration":56124}},{"uid":"e82678b5bf7357c7","reportUrl":"../3322//#testresult/e82678b5bf7357c7","status":"broken","statusDetails":"KeyError: 'defaultreplicaset'","time":{"start":1759975482661,"stop":1759975554569,"duration":71908}},{"uid":"80fc2d4047a03f2a","reportUrl":"../3318//#testresult/80fc2d4047a03f2a","status":"broken","statusDetails":"KeyError: 'defaultreplicaset'","time":{"start":1759889098131,"stop":1759889166497,"duration":68366}},{"uid":"575af8fd2d84c565","reportUrl":"../3311//#testresult/575af8fd2d84c565","status":"passed","time":{"start":1759802260173,"stop":1759802606611,"duration":346438}},{"uid":"2b7a81b7a21ec333","reportUrl":"../3305//#testresult/2b7a81b7a21ec333","status":"broken","statusDetails":"KeyError: 'defaultreplicaset'","time":{"start":1759717845019,"stop":1759717914218,"duration":69199}}]},"tags":["abort_on_fail"]},"source":"4b6089c29d881be.json","parameterValues":[]}