{"uid":"458d3c9c311b005f","name":"test_cluster_manual_rejoin","fullName":"tests.integration.high_availability.test_self_healing_restart_graceful#test_cluster_manual_rejoin","historyId":"2c87788420351b6bcd5eac3b10a90dcb","time":{"start":1758853592719,"stop":1758853617262,"duration":24543},"description":"The cluster manual re-join test.\n\n    A graceful restart is performed in one of the instances (choosing Primary to make it painful).\n    In order to verify that the instance can come back ONLINE, after disabling automatic re-join\n    ","descriptionHtml":"<p>The cluster manual re-join test.</p>\n<pre><code>A graceful restart is performed in one of the instances (choosing Primary to make it painful).\nIn order to verify that the instance can come back ONLINE, after disabling automatic re-join\n</code></pre>\n","status":"broken","statusMessage":"KeyError: 'defaultreplicaset'","statusTrace":"Traceback (most recent call last):\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: Optional[TResult] = func()\n                                ^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 262, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n            ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 182, in _multicall\n    return outcome.get_result()\n           ^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_result.py\", line 100, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 177, in pytest_runtest_call\n    raise e\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 169, in pytest_runtest_call\n    item.runtest()\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/python.py\", line 1792, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 182, in _multicall\n    return outcome.get_result()\n           ^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_result.py\", line 100, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/python.py\", line 194, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pytest_asyncio/plugin.py\", line 529, in inner\n    _loop.run_until_complete(task)\n  File \"/usr/lib/python3.12/asyncio/base_events.py\", line 687, in run_until_complete\n    return future.result()\n           ^^^^^^^^^^^^^^^\n  File \"/root/spread_project/tests/integration/high_availability/test_self_healing_restart_graceful.py\", line 87, in test_cluster_manual_rejoin\n    await ensure_all_units_continuous_writes_incrementing(ops_test, credentials=credentials)\n  File \"/root/spread_project/tests/integration/high_availability/high_availability_helpers.py\", line 484, in ensure_all_units_continuous_writes_incrementing\n    primary = await get_primary_unit(ops_test, mysql_units[0], mysql_application_name)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/tests/integration/helpers.py\", line 150, in get_primary_unit\n    for label, member in cluster_status[\"defaultreplicaset\"][\"topology\"].items()\n                         ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^\nKeyError: 'defaultreplicaset'","flaky":false,"newFailed":false,"newBroken":true,"newPassed":false,"retriesCount":1,"retriesStatusChange":true,"beforeStages":[{"name":"event_loop","time":{"start":1758853373443,"stop":1758853373444,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"tmp_path_factory","time":{"start":1758853373444,"stop":1758853373444,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"ops_test","time":{"start":1758853373444,"stop":1758853373656,"duration":212},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"charm","time":{"start":1758853373444,"stop":1758853373444,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"highly_available_cluster","time":{"start":1758853373656,"stop":1758853588648,"duration":214992},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"continuous_writes","time":{"start":1758853588648,"stop":1758853590689,"duration":2041},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"abort_on_fail","time":{"start":1758853588648,"stop":1758853588648,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"credentials","time":{"start":1758853590689,"stop":1758853592718,"duration":2029},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"The cluster manual re-join test.\n\n    A graceful restart is performed in one of the instances (choosing Primary to make it painful).\n    In order to verify that the instance can come back ONLINE, after disabling automatic re-join\n    ","status":"broken","statusMessage":"KeyError: 'defaultreplicaset'","statusTrace":"Traceback (most recent call last):\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: Optional[TResult] = func()\n                                ^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 262, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n            ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 182, in _multicall\n    return outcome.get_result()\n           ^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_result.py\", line 100, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 177, in pytest_runtest_call\n    raise e\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 169, in pytest_runtest_call\n    item.runtest()\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/python.py\", line 1792, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 182, in _multicall\n    return outcome.get_result()\n           ^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_result.py\", line 100, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/python.py\", line 194, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pytest_asyncio/plugin.py\", line 529, in inner\n    _loop.run_until_complete(task)\n  File \"/usr/lib/python3.12/asyncio/base_events.py\", line 687, in run_until_complete\n    return future.result()\n           ^^^^^^^^^^^^^^^\n  File \"/root/spread_project/tests/integration/high_availability/test_self_healing_restart_graceful.py\", line 87, in test_cluster_manual_rejoin\n    await ensure_all_units_continuous_writes_incrementing(ops_test, credentials=credentials)\n  File \"/root/spread_project/tests/integration/high_availability/high_availability_helpers.py\", line 484, in ensure_all_units_continuous_writes_incrementing\n    primary = await get_primary_unit(ops_test, mysql_units[0], mysql_application_name)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/tests/integration/helpers.py\", line 150, in get_primary_unit\n    for label, member in cluster_status[\"defaultreplicaset\"][\"topology\"].items()\n                         ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^\nKeyError: 'defaultreplicaset'","steps":[],"attachments":[{"uid":"d9c0fd359377a148","name":"log","source":"d9c0fd359377a148.txt","type":"text/plain","size":7137}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"continuous_writes::finalizer","time":{"start":1758853617281,"stop":1758853618306,"duration":1025},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"credentials::finalizer","time":{"start":1758853617281,"stop":1758853617281,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"abort_on_fail::0","time":{"start":1758853618306,"stop":1758853618306,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"highly_available_cluster::finalizer","time":{"start":1758853618307,"stop":1758853618307,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"ops_test::finalizer","time":{"start":1758853618307,"stop":1758853618681,"duration":374},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::2","time":{"start":1758853618682,"stop":1758853618682,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::_close_event_loop","time":{"start":1758853618682,"stop":1758853618682,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::_provide_clean_event_loop","time":{"start":1758853618682,"stop":1758853618682,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"tag","value":"asyncio"},{"name":"parentSuite","value":"tests.integration.high_availability"},{"name":"suite","value":"test_self_healing_restart_graceful"},{"name":"host","value":"runnervm3ublj"},{"name":"thread","value":"19039-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.integration.high_availability.test_self_healing_restart_graceful"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[{"uid":"c4c0fed420d35b5d","status":"unknown","time":{}}],"categories":[{"name":"Test defects","matchedStatuses":[]}],"history":{"statistic":{"failed":1,"broken":1,"skipped":0,"passed":193,"unknown":11,"total":206},"items":[{"uid":"2a8ef11b3a3e79cb","reportUrl":"../3277//#testresult/2a8ef11b3a3e79cb","status":"passed","time":{"start":1758765021146,"stop":1758765120335,"duration":99189}},{"uid":"4c3b0d2aac4916f5","reportUrl":"../3271//#testresult/4c3b0d2aac4916f5","status":"passed","time":{"start":1758680142620,"stop":1758680228091,"duration":85471}},{"uid":"f8efa6440b7c02de","reportUrl":"../3262//#testresult/f8efa6440b7c02de","status":"passed","time":{"start":1758596241177,"stop":1758596306746,"duration":65569}},{"uid":"5f5d9f16b599d3dc","reportUrl":"../3255//#testresult/5f5d9f16b599d3dc","status":"passed","time":{"start":1758506421200,"stop":1758506507726,"duration":86526}},{"uid":"ef35b162c6e47ab0","reportUrl":"../3254//#testresult/ef35b162c6e47ab0","status":"passed","time":{"start":1758419633360,"stop":1758419742419,"duration":109059}},{"uid":"e39eab5e4df5c5d","reportUrl":"../3253//#testresult/e39eab5e4df5c5d","status":"passed","time":{"start":1758333237716,"stop":1758333303581,"duration":65865}},{"uid":"d19b624d3716dbd7","reportUrl":"../3252//#testresult/d19b624d3716dbd7","status":"passed","time":{"start":1758250581691,"stop":1758250651853,"duration":70162}},{"uid":"d3fb8e166928ec9a","reportUrl":"../3250//#testresult/d3fb8e166928ec9a","status":"passed","time":{"start":1758161815547,"stop":1758161926573,"duration":111026}},{"uid":"696116561a180e4f","reportUrl":"../3244//#testresult/696116561a180e4f","status":"passed","time":{"start":1758072838799,"stop":1758072947774,"duration":108975}},{"uid":"fd6db19764132145","reportUrl":"../3240//#testresult/fd6db19764132145","status":"passed","time":{"start":1757988338858,"stop":1757988426937,"duration":88079}},{"uid":"16d0c7f09e68795e","reportUrl":"../3239//#testresult/16d0c7f09e68795e","status":"passed","time":{"start":1757901502612,"stop":1757901601436,"duration":98824}},{"uid":"9950eed3a8440898","reportUrl":"../3238//#testresult/9950eed3a8440898","status":"passed","time":{"start":1757815309798,"stop":1757815414832,"duration":105034}},{"uid":"92762b7e5b5f7051","reportUrl":"../3237//#testresult/92762b7e5b5f7051","status":"passed","time":{"start":1757728881358,"stop":1757728947095,"duration":65737}},{"uid":"97cf506ea1810910","reportUrl":"../3233//#testresult/97cf506ea1810910","status":"passed","time":{"start":1757641314363,"stop":1757641390980,"duration":76617}},{"uid":"7a53cc0105d9242e","reportUrl":"../3232//#testresult/7a53cc0105d9242e","status":"passed","time":{"start":1757555874498,"stop":1757556009654,"duration":135156}},{"uid":"60f4a939c54e4f9f","reportUrl":"../3231//#testresult/60f4a939c54e4f9f","status":"passed","time":{"start":1757468965574,"stop":1757469058975,"duration":93401}},{"uid":"99fb72301719a8d0","reportUrl":"../3225//#testresult/99fb72301719a8d0","status":"passed","time":{"start":1757384493855,"stop":1757384561947,"duration":68092}},{"uid":"d58286ea70f24483","reportUrl":"../3223//#testresult/d58286ea70f24483","status":"passed","time":{"start":1757300694091,"stop":1757300785850,"duration":91759}},{"uid":"612b59f9cb44ee77","reportUrl":"../3221//#testresult/612b59f9cb44ee77","status":"passed","time":{"start":1757123796170,"stop":1757123862740,"duration":66570}},{"uid":"5c7323df3450de","reportUrl":"../3212//#testresult/5c7323df3450de","status":"passed","time":{"start":1756950992787,"stop":1756951064663,"duration":71876}}]},"tags":["asyncio"]},"source":"458d3c9c311b005f.json","parameterValues":[]}