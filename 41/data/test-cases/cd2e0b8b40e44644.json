{"uid":"cd2e0b8b40e44644","name":"test_labeling_of_k8s_endpoints","fullName":"tests.integration.integration.high_availability.test_replication_unit_endpoints#test_labeling_of_k8s_endpoints","historyId":"88881c8f2210ee7a8585c9ff9fa39ad5","time":{"start":1766454272673,"stop":1766454277291,"duration":4618},"description":"Test the labeling of k8s endpoints when apps with same cluster-name deployed.","descriptionHtml":"<p>Test the labeling of k8s endpoints when apps with same cluster-name deployed.</p>\n","status":"broken","statusMessage":"lightkube.core.exceptions.ApiError: endpoints \"mysql-k8s2-primary\" not found","statusTrace":"Traceback (most recent call last):\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/lightkube/core/generic_client.py\", line 235, in raise_for_status\n    resp.raise_for_status()\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/httpx/_models.py\", line 761, in raise_for_status\n    raise HTTPStatusError(message, request=request, response=self)\nhttpx.HTTPStatusError: Client error '404 Not Found' for url 'https://10.1.0.242:16443/api/v1/namespaces/testing/endpoints/mysql-k8s2-primary'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: Optional[TResult] = func()\n                                ^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 262, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n            ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 182, in _multicall\n    return outcome.get_result()\n           ^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_result.py\", line 100, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 177, in pytest_runtest_call\n    raise e\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 169, in pytest_runtest_call\n    item.runtest()\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/python.py\", line 1792, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 182, in _multicall\n    return outcome.get_result()\n           ^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_result.py\", line 100, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/python.py\", line 194, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/tests/integration/integration/high_availability/test_replication_unit_endpoints.py\", line 116, in test_labeling_of_k8s_endpoints\n    check_endpoint_addresses(juju, MYSQL_APP_NAME_2)\n  File \"/root/spread_project/tests/integration/integration/high_availability/test_replication_unit_endpoints.py\", line 126, in check_endpoint_addresses\n    cluster_primary_addresses = get_k8s_endpoint_addresses(juju, f\"{mysql_app_name}-primary\")\n                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/tests/integration/helpers_ha.py\", line 156, in get_k8s_endpoint_addresses\n    endpoint = client.get(\n               ^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/lightkube/core/client.py\", line 230, in get\n    return self._client.request(\"get\", res=res, name=name, namespace=namespace)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/lightkube/core/generic_client.py\", line 311, in request\n    return self.handle_response(method, resp, br)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/lightkube/core/generic_client.py\", line 251, in handle_response\n    self.raise_for_status(resp)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/lightkube/core/generic_client.py\", line 237, in raise_for_status\n    raise transform_exception(e)\nlightkube.core.exceptions.ApiError: endpoints \"mysql-k8s2-primary\" not found","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":1,"retriesStatusChange":true,"beforeStages":[{"name":"juju","time":{"start":1766454108657,"stop":1766454108940,"duration":283},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"abort_on_fail","time":{"start":1766454272673,"stop":1766454272673,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"Test the labeling of k8s endpoints when apps with same cluster-name deployed.","status":"broken","statusMessage":"lightkube.core.exceptions.ApiError: endpoints \"mysql-k8s2-primary\" not found","statusTrace":"Traceback (most recent call last):\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/lightkube/core/generic_client.py\", line 235, in raise_for_status\n    resp.raise_for_status()\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/httpx/_models.py\", line 761, in raise_for_status\n    raise HTTPStatusError(message, request=request, response=self)\nhttpx.HTTPStatusError: Client error '404 Not Found' for url 'https://10.1.0.242:16443/api/v1/namespaces/testing/endpoints/mysql-k8s2-primary'\nFor more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: Optional[TResult] = func()\n                                ^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 262, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n            ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 182, in _multicall\n    return outcome.get_result()\n           ^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_result.py\", line 100, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 177, in pytest_runtest_call\n    raise e\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 169, in pytest_runtest_call\n    item.runtest()\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/python.py\", line 1792, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 182, in _multicall\n    return outcome.get_result()\n           ^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_result.py\", line 100, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/python.py\", line 194, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/tests/integration/integration/high_availability/test_replication_unit_endpoints.py\", line 116, in test_labeling_of_k8s_endpoints\n    check_endpoint_addresses(juju, MYSQL_APP_NAME_2)\n  File \"/root/spread_project/tests/integration/integration/high_availability/test_replication_unit_endpoints.py\", line 126, in check_endpoint_addresses\n    cluster_primary_addresses = get_k8s_endpoint_addresses(juju, f\"{mysql_app_name}-primary\")\n                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/tests/integration/helpers_ha.py\", line 156, in get_k8s_endpoint_addresses\n    endpoint = client.get(\n               ^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/lightkube/core/client.py\", line 230, in get\n    return self._client.request(\"get\", res=res, name=name, namespace=namespace)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/lightkube/core/generic_client.py\", line 311, in request\n    return self.handle_response(method, resp, br)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/lightkube/core/generic_client.py\", line 251, in handle_response\n    self.raise_for_status(resp)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/lightkube/core/generic_client.py\", line 237, in raise_for_status\n    raise transform_exception(e)\nlightkube.core.exceptions.ApiError: endpoints \"mysql-k8s2-primary\" not found","steps":[],"attachments":[{"uid":"6ad25d2a5ed56707","name":"log","source":"6ad25d2a5ed56707.txt","type":"text/plain","size":1385}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"abort_on_fail::0","time":{"start":1766454277294,"stop":1766454277294,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"juju::0","time":{"start":1766454277295,"stop":1766454277653,"duration":358},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"tag","value":"abort_on_fail"},{"name":"parentSuite","value":"tests.integration.integration.high_availability"},{"name":"suite","value":"test_replication_unit_endpoints"},{"name":"host","value":"runnervmh13bl"},{"name":"thread","value":"19081-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.integration.integration.high_availability.test_replication_unit_endpoints"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[{"uid":"90dc28e4430f917d","status":"unknown","time":{}}],"categories":[{"name":"Test defects","matchedStatuses":[]}],"history":{"statistic":{"failed":1,"broken":2,"skipped":0,"passed":13,"unknown":0,"total":16},"items":[{"uid":"5399e486bc502a14","reportUrl":"../40//#testresult/5399e486bc502a14","status":"broken","statusDetails":"lightkube.core.exceptions.ApiError: endpoints \"mysql-k8s2-primary\" not found","time":{"start":1766368223367,"stop":1766368225444,"duration":2077}},{"uid":"443a1c5a60aa5a7a","reportUrl":"../39//#testresult/443a1c5a60aa5a7a","status":"passed","time":{"start":1766281790617,"stop":1766281793832,"duration":3215}},{"uid":"2628e7401637675e","reportUrl":"../38//#testresult/2628e7401637675e","status":"passed","time":{"start":1766195207268,"stop":1766195212921,"duration":5653}},{"uid":"e89871be2732f66","reportUrl":"../37//#testresult/e89871be2732f66","status":"passed","time":{"start":1766110302467,"stop":1766110305446,"duration":2979}},{"uid":"ecefa26ca004bbc6","reportUrl":"../36//#testresult/ecefa26ca004bbc6","status":"passed","time":{"start":1766023001341,"stop":1766023004550,"duration":3209}},{"uid":"4ea811ba6b8005dd","reportUrl":"../35//#testresult/4ea811ba6b8005dd","status":"passed","time":{"start":1765936862717,"stop":1765936865659,"duration":2942}},{"uid":"bbbc2a13f36cf46a","reportUrl":"../34//#testresult/bbbc2a13f36cf46a","status":"passed","time":{"start":1765850585957,"stop":1765850590205,"duration":4248}},{"uid":"7e0bc283c23bcfe","reportUrl":"../33//#testresult/7e0bc283c23bcfe","status":"passed","time":{"start":1765785736883,"stop":1765785740670,"duration":3787}},{"uid":"c46ecd67eff875c2","reportUrl":"../31//#testresult/c46ecd67eff875c2","status":"passed","time":{"start":1765590633878,"stop":1765590637369,"duration":3491}},{"uid":"5baba9eb50a5c7bd","reportUrl":"../30//#testresult/5baba9eb50a5c7bd","status":"passed","time":{"start":1765504243126,"stop":1765504246010,"duration":2884}},{"uid":"19c422dd2b3d965c","reportUrl":"../29//#testresult/19c422dd2b3d965c","status":"failed","statusDetails":"AssertionError: assert {'10.1.106.14...10.1.106.150'} == {'10.1.106.14...10.1.106.150'}\n  Extra items in the right set:\n  '10.1.106.149'\n  Full diff:\n  - {'10.1.106.148', '10.1.106.150', '10.1.106.149'}\n  ?                                ----------------\n  + {'10.1.106.148', '10.1.106.150'}","time":{"start":1765420423431,"stop":1765420427236,"duration":3805}},{"uid":"5a01018f52a7cb22","reportUrl":"../26//#testresult/5a01018f52a7cb22","status":"passed","time":{"start":1765161417202,"stop":1765161420680,"duration":3478}},{"uid":"7c529e852a153827","reportUrl":"../25//#testresult/7c529e852a153827","status":"passed","time":{"start":1765074252553,"stop":1765074257215,"duration":4662}},{"uid":"db66279201e557ee","reportUrl":"../24//#testresult/db66279201e557ee","status":"passed","time":{"start":1764986761667,"stop":1764986766799,"duration":5132}},{"uid":"1d2439a6b44c6810","reportUrl":"../3498//#testresult/1d2439a6b44c6810","status":"passed","time":{"start":1764619200816,"stop":1764619205237,"duration":4421}}]},"tags":["abort_on_fail"]},"source":"cd2e0b8b40e44644.json","parameterValues":[]}