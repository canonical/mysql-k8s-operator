[32mINFO    [0m integration.integration.test_backup_aws:test_backup_aws.py:303 Deploying a new mysql cluster
[32mINFO    [0m juju.model:model.py:2284 Deploying local:mysql-k8s-1
[32mINFO    [0m juju.model:model.py:3211 Waiting for model:
  another-mysql-k8s/0 [allocating] waiting: installing agent
[32mINFO    [0m juju.model:model.py:3211 Waiting for model:
  another-mysql-k8s/0 [executing] maintenance: Initialising mysqld
[32mINFO    [0m juju.model:model.py:3211 Waiting for model:
  another-mysql-k8s/0 [idle] active: Primary
[33mWARNING [0m juju.model:model.py:1666 relate is deprecated and will be removed. Use integrate instead.
[32mINFO    [0m juju.model:model.py:3211 Waiting for model:
  another-mysql-k8s/0 [idle] active: Primary
  s3-integrator/0 [executing] active: 
[32mINFO    [0m integration.integration.test_backup_aws:test_backup_aws.py:322 Rotating all mysql credentials
[32mINFO    [0m integration.integration.test_backup_aws:test_backup_aws.py:339 Syncing credentials
[32mINFO    [0m juju.model:model.py:3211 Waiting for model:
  another-mysql-k8s/0 [idle] active: Primary
  s3-integrator/0 [idle] active: 
[32mINFO    [0m integration.integration.test_backup_aws:test_backup_aws.py:353 Waiting for blocked application status with another cluster S3 repository
[32mINFO    [0m integration.integration.test_backup_aws:test_backup_aws.py:361 Restoring backup_id='2025-12-23T01:47:33Z'
[32mINFO    [0m integration.integration.test_backup_aws:test_backup_aws.py:366 Ensuring that the pre-backup inserted value exists in database, while post-backup inserted value does not
[32mINFO    [0m integration.integration.test_backup_aws:test_backup_aws.py:380 Inserting value after restore
[32mINFO    [0m integration.integration.test_backup_aws:test_backup_aws.py:389 Ensuring that pre-backup and post-restore values exist in the database
[32mINFO    [0m integration.integration.test_backup_aws:test_backup_aws.py:400 Scaling mysql application to 3 units
[32mINFO    [0m juju.model:model.py:3211 Waiting for model:
  another-mysql-k8s (waiting for exactly 3 units, current : 1)
[32mINFO    [0m juju.model:model.py:3211 Waiting for model:
  another-mysql-k8s/0 [executing] active: Primary
  another-mysql-k8s/2 [executing] maintenance: Initialising mysqld
  another-mysql-k8s/1 [executing] maintenance: Initialising mysqld
[32mINFO    [0m juju.model:model.py:3211 Waiting for model:
  another-mysql-k8s/0 [idle] active: Primary
  another-mysql-k8s/2 [executing] waiting: waiting to get cluster primary from peers
  another-mysql-k8s/1 [executing] waiting: waiting to get cluster primary from peers
[32mINFO    [0m juju.model:model.py:3211 Waiting for model:
  another-mysql-k8s/0 [idle] active: Primary
  another-mysql-k8s/2 [executing] active: 
  another-mysql-k8s/1 [executing] maintenance: joining the cluster
[32mINFO    [0m integration.integration.test_backup_aws:test_backup_aws.py:408 Ensuring inserted values before backup and after restore exist on all units
[32mINFO    [0m integration.integration.test_backup_aws:test_backup_aws.py:426 Waiting for blocked application status after restore
[32mINFO    [0m pytest_operator.plugin:plugin.py:790 Model status:

Model    Controller          Cloud/Region        Version  SLA          Timestamp
testing  concierge-microk8s  microk8s/localhost  3.6.12   unsupported  01:59:54Z

App                Version                  Status   Scale  Charm          Channel        Rev  Address         Exposed  Message
another-mysql-k8s  8.0.44-0ubuntu0.22.04.1  blocked      3  mysql-k8s                       1  10.152.183.113  no       Move restored cluster to another S3 repository
mysql-k8s                                   blocked      3  mysql-k8s                       0  10.152.183.233  no       Move restored cluster to another S3 repository
s3-integrator                               active       1  s3-integrator  latest/stable  145  10.152.183.116  no       

Unit                  Workload  Agent  Address      Ports  Message
another-mysql-k8s/0*  active    idle   10.1.206.85         Primary
another-mysql-k8s/1   active    idle   10.1.206.91         
another-mysql-k8s/2   active    idle   10.1.206.90         
mysql-k8s/0*          active    idle   10.1.206.77         Primary
mysql-k8s/1           active    idle   10.1.206.82         
mysql-k8s/2           active    idle   10.1.206.81         
s3-integrator/0*      active    idle   10.1.206.80         

[32mINFO    [0m pytest_operator.plugin:plugin.py:796 Juju error logs:

unit-mysql-k8s-2: 01:47:54 ERROR unit.mysql-k8s/2.juju-log Uncaught exception while in charm code:
Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-mysql-k8s-2/charm/src/charm.py", line 1139, in <module>
    main(MySQLOperatorCharm)
  File "/var/lib/juju/agents/unit-mysql-k8s-2/charm/venv/lib/python3.10/site-packages/ops/main.py", line 551, in main
    manager.run()
  File "/var/lib/juju/agents/unit-mysql-k8s-2/charm/venv/lib/python3.10/site-packages/ops/main.py", line 530, in run
    self._emit()
  File "/var/lib/juju/agents/unit-mysql-k8s-2/charm/venv/lib/python3.10/site-packages/ops/main.py", line 519, in _emit
    _emit_charm_event(self.charm, self.dispatcher.event_name)
  File "/var/lib/juju/agents/unit-mysql-k8s-2/charm/venv/lib/python3.10/site-packages/ops/main.py", line 147, in _emit_charm_event
    event_to_emit.emit(*args, **kwargs)
  File "/var/lib/juju/agents/unit-mysql-k8s-2/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 348, in emit
    framework._emit(event)
  File "/var/lib/juju/agents/unit-mysql-k8s-2/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 860, in _emit
    self._reemit(event_path)
  File "/var/lib/juju/agents/unit-mysql-k8s-2/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 950, in _reemit
    custom_handler(event)
  File "/var/lib/juju/agents/unit-mysql-k8s-2/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 1065, in wrapped_function
    return callable(*args, **kwargs)  # type: ignore
  File "/var/lib/juju/agents/unit-mysql-k8s-2/charm/src/charm.py", line 1113, in _on_database_storage_detaching
    self._mysql.set_cluster_primary(
  File "/var/lib/juju/agents/unit-mysql-k8s-2/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 1065, in wrapped_function
    return callable(*args, **kwargs)  # type: ignore
  File "/var/lib/juju/agents/unit-mysql-k8s-2/charm/src/mysql_k8s_helpers.py", line 919, in set_cluster_primary
    self.update_endpoints(PEER)
  File "/var/lib/juju/agents/unit-mysql-k8s-2/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 1065, in wrapped_function
    return callable(*args, **kwargs)  # type: ignore
  File "/var/lib/juju/agents/unit-mysql-k8s-2/charm/src/mysql_k8s_helpers.py", line 901, in update_endpoints
    rw_endpoints, ro_endpoints, offline = self.charm.get_cluster_endpoints(relation_name)
  File "/var/lib/juju/agents/unit-mysql-k8s-2/charm/lib/charms/tempo_coordinator_k8s/v0/charm_tracing.py", line 1065, in wrapped_function
    return callable(*args, **kwargs)  # type: ignore
  File "/var/lib/juju/agents/unit-mysql-k8s-2/charm/lib/charms/mysql/v0/mysql.py", line 889, in get_cluster_endpoints
    address = f"{self.get_unit_address(unit_labels[k], relation_name)}:3306"
KeyError: 'mysql-k8s-1.mysql-k8s-endpoints.testing.svc.cluster.local.:3306'
unit-mysql-k8s-2: 01:47:54 ERROR juju.worker.uniter.operation hook "database-storage-detaching" (via hook dispatching script: dispatch) failed: exit status 1

[32mINFO    [0m pytest_operator.plugin:plugin.py:862 Forgetting main...
[32mINFO    [0m integration.integration.test_backup_aws:test_backup_aws.py:77 Cleaning backups from buckets