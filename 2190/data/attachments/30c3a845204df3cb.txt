[32mINFO    [0m pytest_operator.plugin:plugin.py:675 Connecting to existing model microk8s-localhost:test on unspecified cloud
[32mINFO    [0m integration.high_availability.conftest:conftest.py:68 Deploying mysql-k8s and scaling to 3 units
[32mINFO    [0m juju.model:model.py:2097 Deploying local:jammy/mysql-k8s-0
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  mysql-k8s/0 [allocating] waiting: installing agent
  mysql-k8s/1 [allocating] waiting: installing agent
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  mysql-k8s/0 [executing] maintenance: Initialising mysqld
  mysql-k8s/1 [executing] maintenance: Initialising mysqld
  mysql-k8s/2 [executing] maintenance: Initialising mysqld
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  mysql-k8s/0 [executing] waiting: waiting to get cluster primary from peers
  mysql-k8s/1 [executing] active: Primary
  mysql-k8s/2 [idle] waiting: waiting to get cluster primary from peers
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  mysql-k8s/0 [idle] maintenance: joining the cluster
  mysql-k8s/1 [idle] active: Primary
  mysql-k8s/2 [executing] active: 
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  mysql-k8s/0 [idle] active: 
  mysql-k8s/1 [idle] active: Primary
  mysql-k8s/2 [idle] active: 
[32mINFO    [0m integration.high_availability.conftest:conftest.py:71 Deploying mysql-test-app
[32mINFO    [0m juju.model:model.py:2097 Deploying ch:amd64/jammy/mysql-test-app-46
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  mysql-test-app/0 [allocating] waiting: installing agent
[32mINFO    [0m integration.high_availability.conftest:conftest.py:74 Relating mysql-k8s with mysql-test-app
[33mWARNING [0m juju.model:model.py:1563 relate is deprecated and will be removed. Use integrate instead.
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  mysql-k8s/0 [idle] active: 
  mysql-k8s/1 [idle] active: Primary
  mysql-k8s/2 [idle] active: 
  mysql-test-app/0 [idle] waiting: 
[32mINFO    [0m integration.high_availability.conftest:conftest.py:29 Clearing continuous writes
[32mINFO    [0m integration.high_availability.conftest:conftest.py:31 Starting continuous writes
[32mINFO    [0m juju.model:model.py:2097 Deploying local:jammy/mysql-k8s-1
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  another-mysql/0 [allocating] waiting: installing agent
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  another-mysql/0 [executing] maintenance: Initialising mysqld
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  another-mysql/0 [idle] active: Primary
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  another-mysql/0 [idle] active: Primary
[32mINFO    [0m integration.high_availability.conftest:conftest.py:36 Clearing continuous writes
[32mINFO    [0m pytest_operator.plugin:plugin.py:790 Model status:

Model  Controller          Cloud/Region        Version  SLA          Timestamp
test   microk8s-localhost  microk8s/localhost  3.4.5    unsupported  01:36:34Z

App             Version                  Status  Scale  Charm           Channel      Rev  Address         Exposed  Message
another-mysql   8.0.37-0ubuntu0.22.04.3  active    1/0  mysql-k8s                      1  10.152.183.145  no       
mysql-k8s       8.0.37-0ubuntu0.22.04.3  active      3  mysql-k8s                      0  10.152.183.43   no       
mysql-test-app  0.0.2                    active      1  mysql-test-app  latest/edge   46  10.152.183.54   no       Last written value=4784

Unit               Workload  Agent      Address      Ports  Message
another-mysql/0*   active    executing  10.1.140.16         Primary
mysql-k8s/0        active    idle       10.1.140.11         
mysql-k8s/1*       active    idle       10.1.140.12         Primary
mysql-k8s/2        active    idle       10.1.140.13         
mysql-test-app/0*  active    idle       10.1.140.14         Last written value=4784

[32mINFO    [0m pytest_operator.plugin:plugin.py:796 Juju error logs:

unit-mysql-test-app-0: 01:36:33 ERROR unit.mysql-test-app/0.juju-log Uncaught exception while in charm code:
Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-mysql-test-app-0/charm/venv/mysql/connector/connection_cext.py", line 291, in _open_connection
    self._cmysql.connect(**cnx_kwargs)
_mysql_connector.MySQLInterfaceError: Access denied for user 'relation-4_855879155daf417'@'mysql-test-app-0.mysql-test-app-endpoints.test.svc.cluster.local' (using password: YES)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-mysql-test-app-0/charm/./src/charm.py", line 455, in <module>
    main(MySQLTestApplication)
  File "/var/lib/juju/agents/unit-mysql-test-app-0/charm/venv/ops/main.py", line 548, in main
    manager.run()
  File "/var/lib/juju/agents/unit-mysql-test-app-0/charm/venv/ops/main.py", line 527, in run
    self._emit()
  File "/var/lib/juju/agents/unit-mysql-test-app-0/charm/venv/ops/main.py", line 516, in _emit
    _emit_charm_event(self.charm, self.dispatcher.event_name)
  File "/var/lib/juju/agents/unit-mysql-test-app-0/charm/venv/ops/main.py", line 147, in _emit_charm_event
    event_to_emit.emit(*args, **kwargs)
  File "/var/lib/juju/agents/unit-mysql-test-app-0/charm/venv/ops/framework.py", line 348, in emit
    framework._emit(event)
  File "/var/lib/juju/agents/unit-mysql-test-app-0/charm/venv/ops/framework.py", line 860, in _emit
    self._reemit(event_path)
  File "/var/lib/juju/agents/unit-mysql-test-app-0/charm/venv/ops/framework.py", line 950, in _reemit
    custom_handler(event)
  File "/var/lib/juju/agents/unit-mysql-test-app-0/charm/./src/charm.py", line 306, in _on_clear_continuous_writes_action
    with MySQLConnector(self._database_config) as cursor:
  File "/var/lib/juju/agents/unit-mysql-test-app-0/charm/src/connector.py", line 42, in __enter__
    self.connection = mysql.connector.connect(**self.config)
  File "/var/lib/juju/agents/unit-mysql-test-app-0/charm/venv/mysql/connector/pooling.py", line 293, in connect
    return CMySQLConnection(*args, **kwargs)
  File "/var/lib/juju/agents/unit-mysql-test-app-0/charm/venv/mysql/connector/connection_cext.py", line 120, in __init__
    self.connect(**kwargs)
  File "/var/lib/juju/agents/unit-mysql-test-app-0/charm/venv/mysql/connector/abstracts.py", line 1181, in connect
    self._open_connection()
  File "/var/lib/juju/agents/unit-mysql-test-app-0/charm/venv/mysql/connector/connection_cext.py", line 296, in _open_connection
    raise get_mysql_exception(
mysql.connector.errors.ProgrammingError: 1045 (28000): Access denied for user 'relation-4_855879155daf417'@'mysql-test-app-0.mysql-test-app-endpoints.test.svc.cluster.local' (using password: YES)

[32mINFO    [0m pytest_operator.plugin:plugin.py:862 Forgetting main...