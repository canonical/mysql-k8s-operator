[32mINFO    [0m jubilant:_juju.py:316 cli: juju version --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing --format json
[32mINFO    [0m root:test_async_replication_upgrade.py:67 Clearing continuous writes
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing --format json mysql-test-app/0 clear-continuous-writes
[32mINFO    [0m root:test_async_replication_upgrade.py:69 Starting continuous writes
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing --format json mysql-test-app/0 start-continuous-writes
[32mINFO    [0m jubilant:_juju.py:316 cli: juju version --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju version --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing --format json
[32mINFO    [0m root:test_async_replication_upgrade.py:262 Run pre-upgrade-check action
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing --format json db1/2 pre-upgrade-check
[32mINFO    [0m root:test_async_replication_upgrade.py:266 Assert slow shutdown is enabled
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing --format json db1/0 get-password --params /root/snap/juju/common/tmpm3ls4qof
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing --format json db1/1 get-password --params /root/snap/juju/common/tmpv2amzub2
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing --format json db1/2 get-password --params /root/snap/juju/common/tmp8nkwu7xs
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing --format json
[32mINFO    [0m root:test_async_replication_upgrade.py:271 Assert primary is set to leader
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing --format json db1/2 get-cluster-status --wait 300s --params /root/snap/juju/common/tmpmcy6byys
[32mINFO    [0m root:test_async_replication_upgrade.py:275 Assert partition is set to 2
[32mINFO    [0m httpx:_client.py:1026 HTTP Request: GET https://10.1.0.163:16443/apis/apps/v1/namespaces/testing/statefulsets/db1 "HTTP/1.1 200 OK"
[32mINFO    [0m root:test_async_replication_upgrade.py:281 Ensure continuous writes are incrementing
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing --format json db1/2 get-cluster-status --wait 300s --params /root/snap/juju/common/tmp2dkcmfpf
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing --format json db1/0 get-password --params /root/snap/juju/common/tmpr1y8wes4
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju model-config --model testing update-status-hook-interval=15s
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing --format json db1/0 get-password --params /root/snap/juju/common/tmph01lopzg
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing --format json db1/1 get-password --params /root/snap/juju/common/tmp0vx5gp20
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing --format json db1/2 get-password --params /root/snap/juju/common/tmpi297furs
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing --format json
[32mINFO    [0m root:test_async_replication_upgrade.py:284 Refresh the charm
[32mINFO    [0m jubilant:_juju.py:316 cli: juju refresh --model testing db1 --path ./mysql-k8s_ubuntu@22.04-amd64.charm
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing --format json
[32mINFO    [0m root:test_async_replication_upgrade.py:290 Wait for upgrade to complete on first upgrading unit
[32mINFO    [0m root:test_async_replication_upgrade.py:296 Resume upgrade
[32mINFO    [0m httpx:_client.py:1026 HTTP Request: GET https://10.1.0.163:16443/apis/apps/v1/namespaces/testing/statefulsets/db1 "HTTP/1.1 200 OK"
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing --format json db1/2 resume-upgrade
[32mINFO    [0m httpx:_client.py:1026 HTTP Request: GET https://10.1.0.163:16443/apis/apps/v1/namespaces/testing/statefulsets/db1 "HTTP/1.1 200 OK"
[32mINFO    [0m root:test_async_replication_upgrade.py:306 Wait for upgrade to complete
[32mINFO    [0m root:test_async_replication_upgrade.py:312 Ensure continuous writes are incrementing
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing --format json db1/2 get-cluster-status --wait 300s --params /root/snap/juju/common/tmp_yc1d4jg
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing --format json db1/1 get-password --params /root/snap/juju/common/tmpwhz7f1gd
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju model-config --model testing update-status-hook-interval=15s
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing --format json db1/0 get-password --params /root/snap/juju/common/tmp8_c9y0qi
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing --format json db1/1 get-password --params /root/snap/juju/common/tmpib6nmu0d
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing --format json db1/2 get-password --params /root/snap/juju/common/tmpkb053oz6
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing-other --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing-other --format json
[32mINFO    [0m root:test_async_replication_upgrade.py:262 Run pre-upgrade-check action
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing-other --format json db2/0 pre-upgrade-check
[32mINFO    [0m root:test_async_replication_upgrade.py:266 Assert slow shutdown is enabled
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing-other --format json db2/0 get-password --params /root/snap/juju/common/tmpfljpmqb1
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing-other --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing-other --format json db2/1 get-password --params /root/snap/juju/common/tmpt5xfjvra
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing-other --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing-other --format json db2/2 get-password --params /root/snap/juju/common/tmp6ur8x0ha
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing-other --format json
[32mINFO    [0m root:test_async_replication_upgrade.py:271 Assert primary is set to leader
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing-other --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing-other --format json db2/0 get-cluster-status --wait 300s --params /root/snap/juju/common/tmpkcvycg4e
[32mINFO    [0m root:test_async_replication_upgrade.py:275 Assert partition is set to 2
[32mINFO    [0m httpx:_client.py:1026 HTTP Request: GET https://10.1.0.163:16443/apis/apps/v1/namespaces/testing-other/statefulsets/db2 "HTTP/1.1 200 OK"
[32mINFO    [0m root:test_async_replication_upgrade.py:281 Ensure continuous writes are incrementing
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing-other --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing-other --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing-other --format json db2/0 get-cluster-status --wait 300s --params /root/snap/juju/common/tmpsr0c1_0a
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing-other --format json db2/0 get-password --params /root/snap/juju/common/tmp5z1e_8oc
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing-other --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju model-config --model testing-other update-status-hook-interval=15s
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing-other --format json db2/0 get-password --params /root/snap/juju/common/tmpqz0s8ghb
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing-other --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing-other --format json db2/1 get-password --params /root/snap/juju/common/tmprsfxbtw5
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing-other --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing-other --format json db2/2 get-password --params /root/snap/juju/common/tmp89f678pi
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing-other --format json
[32mINFO    [0m root:test_async_replication_upgrade.py:284 Refresh the charm
[32mINFO    [0m jubilant:_juju.py:316 cli: juju refresh --model testing-other db2 --path ./mysql-k8s_ubuntu@22.04-amd64.charm
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing-other --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing-other --format json
[32mINFO    [0m root:test_async_replication_upgrade.py:290 Wait for upgrade to complete on first upgrading unit
[32mINFO    [0m root:test_async_replication_upgrade.py:296 Resume upgrade
[32mINFO    [0m httpx:_client.py:1026 HTTP Request: GET https://10.1.0.163:16443/apis/apps/v1/namespaces/testing-other/statefulsets/db2 "HTTP/1.1 200 OK"
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing-other --format json db2/0 resume-upgrade
[32mINFO    [0m httpx:_client.py:1026 HTTP Request: GET https://10.1.0.163:16443/apis/apps/v1/namespaces/testing-other/statefulsets/db2 "HTTP/1.1 200 OK"
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing-other --format json db2/0 resume-upgrade
[32mINFO    [0m httpx:_client.py:1026 HTTP Request: GET https://10.1.0.163:16443/apis/apps/v1/namespaces/testing-other/statefulsets/db2 "HTTP/1.1 200 OK"
[32mINFO    [0m root:test_async_replication_upgrade.py:306 Wait for upgrade to complete
[32mINFO    [0m root:test_async_replication_upgrade.py:312 Ensure continuous writes are incrementing
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing-other --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing-other --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing-other --format json db2/0 get-cluster-status --wait 300s --params /root/snap/juju/common/tmpyhnw1rl6
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing-other --format json db2/1 get-password --params /root/snap/juju/common/tmpkyqfq00q
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing-other --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju model-config --model testing-other update-status-hook-interval=15s
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing-other --format json db2/0 get-password --params /root/snap/juju/common/tmp5l0vaz4b
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing-other --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing-other --format json db2/1 get-password --params /root/snap/juju/common/tmpsat925ms
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing-other --format json
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing-other --format json db2/2 get-password --params /root/snap/juju/common/tmp665c2k9a
[32mINFO    [0m jubilant:_juju.py:316 cli: juju status --model testing-other --format json
[32mINFO    [0m root:test_async_replication_upgrade.py:74 Clearing continuous writes
[32mINFO    [0m jubilant:_juju.py:316 cli: juju run --model testing --format json mysql-test-app/0 clear-continuous-writes