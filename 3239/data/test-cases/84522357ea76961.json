{"uid":"84522357ea76961","name":"test_cluster_failover_after_majority_loss","fullName":"tests.integration.high_availability.test_primary_switchover#test_cluster_failover_after_majority_loss","historyId":"bade0bcc44a661c58105aab821721f91","time":{"start":1757901370032,"stop":1757901474509,"duration":104477},"description":"Test the promote-to-primary command after losing the majority of nodes, with force flag.","descriptionHtml":"<p>Test the promote-to-primary command after losing the majority of nodes, with force flag.</p>\n","status":"broken","statusMessage":"jubilant._task.TaskError: task error: Task 10: status 'failed', return code 0, details:\nResults: {'message': 'Unit is already primary', 'success': 'True'}\nMessage: Failed to force quorum from instance. See logs for more information.","statusTrace":"Traceback (most recent call last):\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: Optional[TResult] = func()\n                                ^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 262, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n            ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 182, in _multicall\n    return outcome.get_result()\n           ^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_result.py\", line 100, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 177, in pytest_runtest_call\n    raise e\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 169, in pytest_runtest_call\n    item.runtest()\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/python.py\", line 1792, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 182, in _multicall\n    return outcome.get_result()\n           ^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_result.py\", line 100, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/python.py\", line 194, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/tests/integration/high_availability/test_primary_switchover.py\", line 80, in test_cluster_failover_after_majority_loss\n    failover_task = juju.run(\n                    ^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/jubilant/_juju.py\", line 879, in run\n    task.raise_on_failure()\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/jubilant/_task.py\", line 100, in raise_on_failure\n    raise TaskError(self)\njubilant._task.TaskError: task error: Task 10: status 'failed', return code 0, details:\nResults: {'message': 'Unit is already primary', 'success': 'True'}\nMessage: Failed to force quorum from instance. See logs for more information.","flaky":false,"newFailed":false,"newBroken":true,"newPassed":false,"retriesCount":1,"retriesStatusChange":true,"beforeStages":[{"name":"charm","time":{"start":1757901166382,"stop":1757901166382,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"tmp_path_factory","time":{"start":1757901166383,"stop":1757901166383,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop","time":{"start":1757901166383,"stop":1757901166383,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"juju","time":{"start":1757901166383,"stop":1757901166383,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"ops_test","time":{"start":1757901166383,"stop":1757901166609,"duration":226},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"highly_available_cluster","time":{"start":1757901166610,"stop":1757901348301,"duration":181691},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"abort_on_fail","time":{"start":1757901370031,"stop":1757901370031,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"Test the promote-to-primary command after losing the majority of nodes, with force flag.","status":"broken","statusMessage":"jubilant._task.TaskError: task error: Task 10: status 'failed', return code 0, details:\nResults: {'message': 'Unit is already primary', 'success': 'True'}\nMessage: Failed to force quorum from instance. See logs for more information.","statusTrace":"Traceback (most recent call last):\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: Optional[TResult] = func()\n                                ^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 262, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n            ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 182, in _multicall\n    return outcome.get_result()\n           ^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_result.py\", line 100, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 177, in pytest_runtest_call\n    raise e\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 169, in pytest_runtest_call\n    item.runtest()\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/python.py\", line 1792, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 182, in _multicall\n    return outcome.get_result()\n           ^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_result.py\", line 100, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/python.py\", line 194, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/tests/integration/high_availability/test_primary_switchover.py\", line 80, in test_cluster_failover_after_majority_loss\n    failover_task = juju.run(\n                    ^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/jubilant/_juju.py\", line 879, in run\n    task.raise_on_failure()\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/jubilant/_task.py\", line 100, in raise_on_failure\n    raise TaskError(self)\njubilant._task.TaskError: task error: Task 10: status 'failed', return code 0, details:\nResults: {'message': 'Unit is already primary', 'success': 'True'}\nMessage: Failed to force quorum from instance. See logs for more information.","steps":[],"attachments":[{"uid":"b555dae195b99fb3","name":"log","source":"b555dae195b99fb3.txt","type":"text/plain","size":23539}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"abort_on_fail::0","time":{"start":1757901474515,"stop":1757901474515,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"highly_available_cluster::finalizer","time":{"start":1757901474515,"stop":1757901474516,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"ops_test::finalizer","time":{"start":1757901474517,"stop":1757901475172,"duration":655},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::2","time":{"start":1757901475173,"stop":1757901475173,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::_close_event_loop","time":{"start":1757901475173,"stop":1757901475173,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::_provide_clean_event_loop","time":{"start":1757901475173,"stop":1757901475174,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"juju::0","time":{"start":1757901475175,"stop":1757901475452,"duration":277},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"tag","value":"abort_on_fail"},{"name":"tag","value":"@pytest.mark.skipif(False, reason='Requires juju 3+')"},{"name":"parentSuite","value":"tests.integration.high_availability"},{"name":"suite","value":"test_primary_switchover"},{"name":"host","value":"runnervmf4ws1"},{"name":"thread","value":"19196-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.integration.high_availability.test_primary_switchover"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[{"uid":"efb62f99ac00c650","status":"unknown","time":{}}],"categories":[{"name":"Test defects","matchedStatuses":[]}],"history":{"statistic":{"failed":0,"broken":1,"skipped":0,"passed":15,"unknown":2,"total":18},"items":[{"uid":"77b42167e341f769","reportUrl":"../3238//#testresult/77b42167e341f769","status":"passed","time":{"start":1757815061266,"stop":1757815300860,"duration":239594}},{"uid":"5f742867c5263671","reportUrl":"../3237//#testresult/5f742867c5263671","status":"passed","time":{"start":1757728985014,"stop":1757729215725,"duration":230711}},{"uid":"230cd02063ec6b04","reportUrl":"../3233//#testresult/230cd02063ec6b04","status":"passed","time":{"start":1757641446013,"stop":1757641714514,"duration":268501}},{"uid":"55c4947d48b939f4","reportUrl":"../3232//#testresult/55c4947d48b939f4","status":"passed","time":{"start":1757555852964,"stop":1757556101892,"duration":248928}},{"uid":"47f55754bace4636","reportUrl":"../3231//#testresult/47f55754bace4636","status":"passed","time":{"start":1757468947266,"stop":1757469238259,"duration":290993}},{"uid":"bd073e1e8a987ed1","reportUrl":"../3225//#testresult/bd073e1e8a987ed1","status":"passed","time":{"start":1757383865875,"stop":1757384098423,"duration":232548}},{"uid":"939db7e03384c144","reportUrl":"../3223//#testresult/939db7e03384c144","status":"unknown","time":{}},{"uid":"e87ef49b5d48435d","reportUrl":"../3221//#testresult/e87ef49b5d48435d","status":"unknown","time":{}},{"uid":"2dccfb5997cb130f","reportUrl":"../3212//#testresult/2dccfb5997cb130f","status":"passed","time":{"start":1756951057146,"stop":1756951298634,"duration":241488}},{"uid":"4991977b9136829a","reportUrl":"../3206//#testresult/4991977b9136829a","status":"passed","time":{"start":1756863876947,"stop":1756864133561,"duration":256614}},{"uid":"b121b50dda9feecd","reportUrl":"../3195//#testresult/b121b50dda9feecd","status":"passed","time":{"start":1756777971431,"stop":1756778253209,"duration":281778}},{"uid":"33824d6ba894da4e","reportUrl":"../3193//#testresult/33824d6ba894da4e","status":"passed","time":{"start":1756690730879,"stop":1756690963347,"duration":232468}},{"uid":"935328d906842f1f","reportUrl":"../3192//#testresult/935328d906842f1f","status":"passed","time":{"start":1756604085944,"stop":1756604357317,"duration":271373}},{"uid":"ce1540827243ed80","reportUrl":"../3190//#testresult/ce1540827243ed80","status":"passed","time":{"start":1756519620464,"stop":1756519875579,"duration":255115}},{"uid":"99e164d44896188c","reportUrl":"../3189//#testresult/99e164d44896188c","status":"passed","time":{"start":1756435531005,"stop":1756435812484,"duration":281479}},{"uid":"7e2ae5b1f66e5f24","reportUrl":"../3188//#testresult/7e2ae5b1f66e5f24","status":"passed","time":{"start":1756346616025,"stop":1756346856493,"duration":240468}},{"uid":"e15fa797a84659fe","reportUrl":"../3184//#testresult/e15fa797a84659fe","status":"passed","time":{"start":1756259730327,"stop":1756259978043,"duration":247716}}]},"tags":["abort_on_fail","@pytest.mark.skipif(False, reason='Requires juju 3+')"]},"source":"84522357ea76961.json","parameterValues":[]}