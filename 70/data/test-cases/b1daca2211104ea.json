{"uid":"b1daca2211104ea","name":"test_data_replication","fullName":"tests.integration.integration.high_availability.test_async_replication_upgrade#test_data_replication","historyId":"46ac70d1ddded94132c60e6ba02bcf79","time":{"start":1768963190737,"stop":1768963208404,"duration":17667},"description":"Test to write to primary, and read the same data back from replicas.","descriptionHtml":"<p>Test to write to primary, and read the same data back from replicas.</p>\n","status":"broken","statusMessage":"mysql.connector.errors.DatabaseError: 2003 (HY000): Can't connect to MySQL server on '10.1.60.21:3306' (111)","statusTrace":"Traceback (most recent call last):\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/mysql/connector/connection_cext.py\", line 335, in _open_connection\n    self._cmysql.connect(**cnx_kwargs)\n_mysql_connector.MySQLInterfaceError: Can't connect to MySQL server on '10.1.60.21:3306' (111)\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: Optional[TResult] = func()\n                                ^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 262, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n            ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 182, in _multicall\n    return outcome.get_result()\n           ^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_result.py\", line 100, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 177, in pytest_runtest_call\n    raise e\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 169, in pytest_runtest_call\n    item.runtest()\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/python.py\", line 1792, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 182, in _multicall\n    return outcome.get_result()\n           ^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_result.py\", line 100, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/python.py\", line 194, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/tests/integration/integration/high_availability/test_async_replication_upgrade.py\", line 218, in test_data_replication\n    results = get_mysql_max_written_values(first_model, second_model)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/tests/integration/integration/high_availability/test_async_replication_upgrade.py\", line 247, in get_mysql_max_written_values\n    unit_max_value = get_mysql_max_written_value(model_2, MYSQL_APP_2, unit_name)\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/tests/integration/helpers_ha.py\", line 475, in get_mysql_max_written_value\n    output = execute_queries_on_unit(\n             ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/tests/integration/helpers.py\", line 174, in execute_queries_on_unit\n    with MySQLConnector(config, commit) as cursor:\n  File \"/root/spread_project/tests/integration/connector.py\", line 30, in __enter__\n    self.connection = mysql.connector.connect(**self.config)\n                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/mysql/connector/pooling.py\", line 322, in connect\n    return CMySQLConnection(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/mysql/connector/connection_cext.py\", line 151, in __init__\n    self.connect(**kwargs)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/mysql/connector/abstracts.py\", line 1426, in connect\n    self._open_connection()\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/mysql/connector/connection_cext.py\", line 340, in _open_connection\n    raise get_mysql_exception(\nmysql.connector.errors.DatabaseError: 2003 (HY000): Can't connect to MySQL server on '10.1.60.21:3306' (111)","flaky":true,"newFailed":false,"newBroken":true,"newPassed":false,"retriesCount":1,"retriesStatusChange":true,"beforeStages":[{"name":"juju","time":{"start":1768961385662,"stop":1768961385976,"duration":314},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"second_model","time":{"start":1768961385977,"stop":1768961386200,"duration":223},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"first_model","time":{"start":1768961385977,"stop":1768961385977,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"abort_on_fail","time":{"start":1768963185032,"stop":1768963185032,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"continuous_writes","time":{"start":1768963185032,"stop":1768963190737,"duration":5705},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"Test to write to primary, and read the same data back from replicas.","status":"broken","statusMessage":"mysql.connector.errors.DatabaseError: 2003 (HY000): Can't connect to MySQL server on '10.1.60.21:3306' (111)","statusTrace":"Traceback (most recent call last):\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/mysql/connector/connection_cext.py\", line 335, in _open_connection\n    self._cmysql.connect(**cnx_kwargs)\n_mysql_connector.MySQLInterfaceError: Can't connect to MySQL server on '10.1.60.21:3306' (111)\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: Optional[TResult] = func()\n                                ^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 262, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n            ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 182, in _multicall\n    return outcome.get_result()\n           ^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_result.py\", line 100, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 177, in pytest_runtest_call\n    raise e\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/runner.py\", line 169, in pytest_runtest_call\n    item.runtest()\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/python.py\", line 1792, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 182, in _multicall\n    return outcome.get_result()\n           ^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_result.py\", line 100, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/_pytest/python.py\", line 194, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/tests/integration/integration/high_availability/test_async_replication_upgrade.py\", line 218, in test_data_replication\n    results = get_mysql_max_written_values(first_model, second_model)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/tests/integration/integration/high_availability/test_async_replication_upgrade.py\", line 247, in get_mysql_max_written_values\n    unit_max_value = get_mysql_max_written_value(model_2, MYSQL_APP_2, unit_name)\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/tests/integration/helpers_ha.py\", line 475, in get_mysql_max_written_value\n    output = execute_queries_on_unit(\n             ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/tests/integration/helpers.py\", line 174, in execute_queries_on_unit\n    with MySQLConnector(config, commit) as cursor:\n  File \"/root/spread_project/tests/integration/connector.py\", line 30, in __enter__\n    self.connection = mysql.connector.connect(**self.config)\n                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/mysql/connector/pooling.py\", line 322, in connect\n    return CMySQLConnection(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/mysql/connector/connection_cext.py\", line 151, in __init__\n    self.connect(**kwargs)\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/mysql/connector/abstracts.py\", line 1426, in connect\n    self._open_connection()\n  File \"/root/spread_project/.tox/integration/lib/python3.12/site-packages/mysql/connector/connection_cext.py\", line 340, in _open_connection\n    raise get_mysql_exception(\nmysql.connector.errors.DatabaseError: 2003 (HY000): Can't connect to MySQL server on '10.1.60.21:3306' (111)","steps":[],"attachments":[{"uid":"b67a6f06f097d001","name":"log","source":"b67a6f06f097d001.txt","type":"text/plain","size":2970}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"continuous_writes::0","time":{"start":1768963208407,"stop":1768963209234,"duration":827},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"abort_on_fail::0","time":{"start":1768963209234,"stop":1768963209234,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"second_model::0","time":{"start":1768963209235,"stop":1768963302284,"duration":93049},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"juju::0","time":{"start":1768963302285,"stop":1768963302499,"duration":214},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"first_model::0","time":{"start":1768963302285,"stop":1768963302285,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"tag","value":"abort_on_fail"},{"name":"tag","value":"@pytest.mark.skipif(False, reason='Requires juju 3+')"},{"name":"parentSuite","value":"tests.integration.integration.high_availability"},{"name":"suite","value":"test_async_replication_upgrade"},{"name":"host","value":"runnervmmtnos"},{"name":"thread","value":"18831-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.integration.integration.high_availability.test_async_replication_upgrade"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[{"uid":"7e4953747c723752","status":"unknown","time":{}}],"categories":[{"name":"Test defects","matchedStatuses":[]}],"history":{"statistic":{"failed":3,"broken":11,"skipped":0,"passed":26,"unknown":2,"total":42},"items":[{"uid":"231477c324b6de72","reportUrl":"../69//#testresult/231477c324b6de72","status":"passed","time":{"start":1768874636004,"stop":1768874655413,"duration":19409}},{"uid":"2e46e94b097ffe37","reportUrl":"../68//#testresult/2e46e94b097ffe37","status":"passed","time":{"start":1768787810154,"stop":1768787831796,"duration":21642}},{"uid":"f321a1f5a3fad836","reportUrl":"../67//#testresult/f321a1f5a3fad836","status":"passed","time":{"start":1768701571048,"stop":1768701590320,"duration":19272}},{"uid":"89687a79285a41e1","reportUrl":"../65//#testresult/89687a79285a41e1","status":"failed","statusDetails":"AssertionError: Data is not consistent across units\nassert False\n +  where False = all(<generator object test_data_replication.<locals>.<genexpr> at 0x7f1e18cb7780>)","time":{"start":1768528584647,"stop":1768528603891,"duration":19244}},{"uid":"ece55ecd25c082ed","reportUrl":"../64//#testresult/ece55ecd25c082ed","status":"passed","time":{"start":1768444614977,"stop":1768444635620,"duration":20643}},{"uid":"547dc6485d06cba9","reportUrl":"../63//#testresult/547dc6485d06cba9","status":"passed","time":{"start":1768357652456,"stop":1768357679893,"duration":27437}},{"uid":"86c379a7afabef77","reportUrl":"../61//#testresult/86c379a7afabef77","status":"broken","statusDetails":"mysql.connector.errors.ProgrammingError: 1049 (42000): Unknown database 'continuous_writes'","time":{"start":1768184964107,"stop":1768184979554,"duration":15447}},{"uid":"48a672cbc92f2b71","reportUrl":"../60//#testresult/48a672cbc92f2b71","status":"broken","statusDetails":"TimeoutError: timed out waiting for action, stderr:\nRunning operation 17 with 1 task\n  - task 18 on unit-db1-0\n\nWaiting for task 18...\nERROR timed out waiting for results from: unit db1/0","time":{"start":1768097263939,"stop":1768097331869,"duration":67930}},{"uid":"b2d2f3c19ba8196","reportUrl":"../59//#testresult/b2d2f3c19ba8196","status":"broken","statusDetails":"mysql.connector.errors.DatabaseError: 2003 (HY000): Can't connect to MySQL server on '10.1.141.146:3306' (111)","time":{"start":1768012588892,"stop":1768012604165,"duration":15273}},{"uid":"c4865d0c64e1062e","reportUrl":"../58//#testresult/c4865d0c64e1062e","status":"passed","time":{"start":1767924470763,"stop":1767924494667,"duration":23904}},{"uid":"bc6d6f46302d8f8e","reportUrl":"../56//#testresult/bc6d6f46302d8f8e","status":"passed","time":{"start":1767752017488,"stop":1767752036996,"duration":19508}},{"uid":"5197df3a344eef5","reportUrl":"../55//#testresult/5197df3a344eef5","status":"broken","statusDetails":"mysql.connector.errors.ProgrammingError: 1049 (42000): Unknown database 'continuous_writes'","time":{"start":1767664930646,"stop":1767664947203,"duration":16557}},{"uid":"4f3ff61c3f268938","reportUrl":"../54//#testresult/4f3ff61c3f268938","status":"failed","statusDetails":"AssertionError: Data is not consistent across units\nassert False\n +  where False = all(<generator object test_data_replication.<locals>.<genexpr> at 0x7f82014bf6b0>)","time":{"start":1767579103903,"stop":1767579125716,"duration":21813}},{"uid":"85f496b546e46891","reportUrl":"../53//#testresult/85f496b546e46891","status":"broken","statusDetails":"mysql.connector.errors.DatabaseError: 2003 (HY000): Can't connect to MySQL server on '10.1.206.83:3306' (111)","time":{"start":1767494164263,"stop":1767494180215,"duration":15952}},{"uid":"14d2458466ab940f","reportUrl":"../52//#testresult/14d2458466ab940f","status":"passed","time":{"start":1767405831220,"stop":1767405853258,"duration":22038}},{"uid":"e2540f80ceb4ecc4","reportUrl":"../51//#testresult/e2540f80ceb4ecc4","status":"passed","time":{"start":1767319426563,"stop":1767319450358,"duration":23795}},{"uid":"364d613325ccd81f","reportUrl":"../50//#testresult/364d613325ccd81f","status":"passed","time":{"start":1767232209225,"stop":1767232229265,"duration":20040}},{"uid":"1be67a31c91e0f39","reportUrl":"../49//#testresult/1be67a31c91e0f39","status":"broken","statusDetails":"mysql.connector.errors.ProgrammingError: 1049 (42000): Unknown database 'continuous_writes'","time":{"start":1767147366761,"stop":1767147382537,"duration":15776}},{"uid":"28841bc7d66f089d","reportUrl":"../48//#testresult/28841bc7d66f089d","status":"broken","statusDetails":"mysql.connector.errors.DatabaseError: 2003 (HY000): Can't connect to MySQL server on '10.1.206.83:3306' (111)","time":{"start":1767060732778,"stop":1767060748082,"duration":15304}},{"uid":"557fef8743dcc104","reportUrl":"../47//#testresult/557fef8743dcc104","status":"passed","time":{"start":1766973132492,"stop":1766973151868,"duration":19376}}]},"tags":["abort_on_fail","@pytest.mark.skipif(False, reason='Requires juju 3+')"]},"source":"b1daca2211104ea.json","parameterValues":[]}